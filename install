#!/usr/bin/env bash
#
# Symlinks all the files, so you can git pull this repo and it updates

defaults() {
	echo defaults "$@"
	command defaults "$@"
}

# Verbose ln (Thanks Dave Eddy!)
symlink() {
	printf '%55s -> %s\n' "${1/#$HOME/\~}" "${2/#$HOME/\~}"
	ln -nsf "$@"
}

symlink_folder() {
	printf '%55s -> %s\n' "${1/#$HOME/\~}" "${2/#$HOME/\~}"
	ln -sf "$@"
}

dotfile_folders=(
	bash
	git
	tmux
	vim
	curl
	wget
	misc
	htop
	extra_bins
)

for folder in "${dotfile_folders[@]}"; do
	if [[ "$folder" == "extra_bins" ]]; then
		[[ -d ~/$folder ]] && rm -rf ~/"$folder"
		symlink_folder "$PWD/$folder" ~/"$folder"
		continue
	fi
	for file in $folder/*; do
		[ -f "$file" ] || continue  # skip if not a regular file


		filename=$(basename $file)
		# Check if file exists and is not a symlink. If it is, delete it
		[[ -d ~/.$filename && ! -L ~/.$filename ]] && rm -r ~/."$filename"

		# echo "Symlinking $folder/$filename to ~/.$filename"
		symlink "$PWD/$folder/$filename" ~/."$filename"
	done
done

echo
echo "$(echo $LESS_TERMCAP_us)DOTFILES INSTALLED SUCCESSFULLY. CAN TEST EXTRA BINS WITH 'ryan_test'"